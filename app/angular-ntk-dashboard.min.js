"use strict";angular.module("admin",["ngRoute","admin.dashboard","ngAnimate"]).config(["$locationProvider","$routeProvider",function(a,e){a.hashPrefix("!"),e.when("/",{redirectTo:"/home"}).when("/home",{}).when("/dashboard",{templateUrl:"dashboard/dashboard.html",controller:"DashboardViewCtrl"}).otherwise({templateUrl:"template/404.html"})}]).config(["$logProvider",function(a){a.debugEnabled(!0)}]).controller("AppCtrl",["$rootScope","$scope","$location","$window","$http","$timeout","$interval",function(r,a,t,e,o,n,i){r.system={currentTime:moment().locale("pt-br").format("L LTS"),currency:"R$",apiURL:""},r.$on("$locationChangeStart",function(a,e){t.path("/dashboard"),r.system.currentTime=moment().locale("pt-br").format("L LTS"),$(".modal-backdrop").remove(),toastr.clear()}),r.converteGatePrice=function(a,e){try{if(isNaN(a))throw"isNaN";var r=(a/100).toFixed(2).split(".");return r[0]=r[0].split(/(?=(?:...)*$)/).join("."),r.join(",")}catch(a){return""}},r.converteDocumento=function(e){try{var a=goodString(e);return 11==(a=a.replace(/\D/g,"")).length?a=(a=(a=a.replace(/(\d{3})(\d)/,"$1.$2")).replace(/(\d{3})(\d)/,"$1.$2")).replace(/(\d{3})(\d{1,2})$/,"$1-$2"):14==a.length?a=(a=(a=(a=a.replace(/(\d{2})(\d)/,"$1.$2")).replace(/(\d{3})(\d)/,"$1.$2")).replace(/(\d{3})(\d)/,"$1/$2")).replace(/(\d{4})(\d{1,2})$/,"$1-$2"):goodString(e)}catch(a){return e}},r.converteTelefone=function(e){try{var a=goodString(e);return 10==(a=e.replace(/\D/g,"")).length?a=(a=a.replace(/(\d{2})(\d)/,"($1) $2")).replace(/(\d{4})(\d)/,"$1-$2"):11==a.length?a=(a=a.replace(/(\d{2})(\d)/,"($1) $2")).replace(/(\d{5})(\d)/,"$1-$2"):goodString(e)}catch(a){return e}},r.padZero=function(a,e){return Array(Math.max(e-String(a).length+1,0)).join(0)+a},r.moment=function(a){return null==a?"":moment(a).locale("pt-br").format("L LTS")},r.momentDate=function(a){return null==a?"":moment(a).format("DD/MM/YYYY")}}]).factory("focus",["$timeout","$window",function(r,t){return function(a){var e=t.document.getElementById(a);e&&e.focus(),r(function(){e&&e.focus()},500)}}]).directive("eventFocus",["focus",function(t){return function(a,e,r){e.on(r.eventFocus,function(){t(r.eventFocusId)}),a.$on("$destroy",function(){e.off(r.eventFocus)})}}]).filter("sumByKey",function(){return function(a,e){if(void 0===a||void 0===e)return 0;for(var r=0,t=a.length-1;0<=t;t--)r+=parseInt(a[t][e]);return r}});var nodeAuthenticateURL="/api/authenticate";angular.module("admin.dashboard",["ngRoute","chart.js","admin.services.dashboard"]).controller("DashboardViewCtrl",["$log","$rootScope","$scope","dashboardService","$timeout",function(a,e,o,r,t){a.debug("-- DashboardViewCtrl LOADED"),o._isLoadingPagetrTrConciliadas=!1,o._isLoadingPageTrNaoConciliadas=!1,o._isLoadingPageTrEDI=!1,o._isLoadingPageTrAdquirentesTipo=!1;var n="4828321, 4828322, 4828323, 4828324, 4828326, 4828327, 4828328, 4828331, 4828334, 4828335, 4828337, 4828339, 4828340, 4828342, 4828343, 4828347, 4828350, 4828351, 4828353, 4828354, 4828357, 4828376, 4828377, 4828378, 4828379";function i(){var r=[],t=[];r.push(""),t.push(""),o.trAdquirentesTipo.forEach(function(a){r.push(a.operacao_Nome);var e=a.valorBruto_Total.replace(".","").replace(",","");t.push(parseInt(e)/100)});var a=google.visualization.arrayToDataTable([r,t]);new google.visualization.BarChart(document.getElementById("chart_div")).draw(a,{title:"Valor transações por tipo",titleTextStyle:{color:"#0a68b4",fontSize:22,bold:!0,italic:!1},chartArea:{width:"50%"}})}function c(a){for(var e=0;e<a.length;e++)switch(a[e].bandeira_Nome){case"MASTERCARD":a[e].url_bandeira="https://gate.2all.com.br/catalog/view/theme/default/images/mastercard.png";break;case"VISA":a[e].url_bandeira="https://gate.2all.com.br/catalog/view/theme/default/images/visa.png";break;case"MAESTRO":a[e].url_bandeira="https://gate.2all.com.br/catalog/view/theme/default/images/mastercard%20maestro.png";break;case"DINERS":a[e].url_bandeira="https://gate.2all.com.br/catalog/view/theme/default/images/diners.png";break;case"AMEX":a[e].url_bandeira="https://gate.2all.com.br/catalog/view/theme/default/images/amex.png";break;case"VISA Electron":a[e].url_bandeira="https://gate.2all.com.br/catalog/view/theme/default/images/visa%20electron.png";break;case"HIPERCARD":a[e].url_bandeira="https://gate.2all.com.br/catalog/view/theme/default/images/hipercard.png";break;case"Hiper":a[e].url_bandeira="https://gate.2all.com.br/catalog/view/theme/default/images/hiper.png";break;case"ELO":a[e].url_bandeira="https://gate.2all.com.br/catalog/view/theme/default/images/elo.png";break;case"DISCOVER":a[e].url_bandeira="https://gate.2all.com.br/catalog/view/theme/default/images/discover.png";break;case"AURA":a[e].url_bandeira="https://gate.2all.com.br/catalog/view/theme/default/images/aura.png";break;case"BANESE CARD":a[e].url_bandeira="https://gate.2all.com.br/catalog/view/theme/default/images/banesecard.png";break;default:a[e].url_bandeira=""}}o.trConciliadas=[],o.trNaoConciliadas=[],o.trEDI=[],o.trAdquirentesTipo=[],google.charts.load("current",{packages:["corechart","bar"]}),google.charts.setOnLoadCallback(i),o.load=function(){o._isLoadingPageTrNaoConciliadas=!0,r.getTransactions(2,n,"3,4").then(function(a){o.trNaoConciliadas=a,c(o.trNaoConciliadas)},function(a){toastr.error("Erro ao carregar as transacoes nao conciliadas"),console.error("Erro ao carregar as transacoes nao conciliadas")}).finally(function(){o._isLoadingPageTrNaoConciliadas=!1,t(function(){o._isLoadingPagetrTrConciliadas=!0,r.getTransactions(1,n,"3,4").then(function(a){o.trConciliadas=a,c(o.trConciliadas)},function(a){toastr.error("Erro ao carregar as transacoes conciliadas"),console.error("Erro ao carregar as transacoes conciliadas")}).finally(function(){o._isLoadingPagetrTrConciliadas=!1,t(function(){o._isLoadingPageTrEDI=!0,r.getTransactions(1,"4828336, 4828341, 4828352","3,4").then(function(a){o.trEDI=a,c(o.trEDI)},function(a){toastr.error("Erro ao carregar as transacoes EDI"),console.error("Erro ao carregar as transacoes EDI")}).finally(function(){o._isLoadingPageTrEDI=!1,t(function(){o._isLoadingPageTrAdquirentesTipo=!0,r.getTrAdquirentesTipo("4828321, 4828322, 4828323, 4828324, 4828326, 4828327, 4828328, 4828331, 4828334, 4828335, 4828337, 4828339, 4828340, 4828342, 4828343, 4828347, 4828350, 4828351, 4828353, 4828354, 4828357, 4828336, 4828341, 4828352, 4828376, 4828377, 4828378, 4828379").then(function(a){o.trAdquirentesTipo=a},function(a){toastr.error("Erro ao carregar as transacoes adquirentes e tipo"),console.error("Erro ao carregar as transacoes adquirentes e tipo")}).finally(function(){o._isLoadingPageTrAdquirentesTipo=!1,i()})},2e3)})},2e3)})},2e3)})};var s=function(){a.debug("* status polling STARTED"),o.load(),setTimeout(function(){"function"==typeof s&&s()},3e4)};s(),o.$on("$destroy",function(){s=null}),o.enabledGraphic=!0,o.sendEnabledGraphic=function(){o.enabledGraphic=!o.enabledGraphic}}]),angular.module("admin.services.dashboard",[]).service("dashboardService",["$log","$http","$q","$window",function(o,n,i,a){return o.debug("- DashboardService LOADED"),{getTransactions:function(a,e,r){o.debug("getTransactions type --\x3e "+a);moment().subtract(30,"days").format("YYYY-MM-DD"),moment().format("YYYY-MM-DD");var t=i.defer();return n({method:"GET",url:"http://api.payreport.com.br/api/AutoCom/GetTransacaoConciliacaoPorTecnologia",headers:{Authorization:"Basic ZmVpcmFudGsyMDE4QG50ay5jb20uYnI6bnRrMjAxOA=="},params:{pessoaId:"3504",tecnologiaId:e,tecnologiaTipoId:r,dataIni:"2018-03-01",dataFim:"2018-12-31",conciliada:a}}).then(function(a){t.resolve(a.data)},function(a){t.reject(a)}),t.promise},getTrAdquirentesTipo:function(a){o.debug("getTrAdquirentesTipo");moment().subtract(30,"days").format("YYYY-MM-DD"),moment().format("YYYY-MM-DD");var e=i.defer();return n({method:"GET",url:"http://api.payreport.com.br/api/AutoCom/GetTransacaoPorTipo",headers:{Authorization:"Basic ZmVpcmFudGsyMDE4QG50ay5jb20uYnI6bnRrMjAxOA=="},params:{pessoaId:"3504",tecnologiaId:a,dataIni:"2018-03-01",dataFim:"2018-12-31"}}).then(function(a){e.resolve(a.data)},function(a){e.reject(a)}),e.promise}}}]);