"use strict";angular.module("admin",["ngRoute","admin.dashboard","ngAnimate"]).config(["$locationProvider","$routeProvider",function(a,o){a.hashPrefix("!"),o.when("/",{redirectTo:"/home"}).when("/home",{}).when("/dashboard",{templateUrl:"dashboard/dashboard.html",controller:"DashboardViewCtrl"}).otherwise({templateUrl:"template/404.html"})}]).config(["$logProvider",function(a){a.debugEnabled(!0)}]).controller("AppCtrl",["$rootScope","$scope","$location","$window","$http","$timeout","$interval",function(r,a,e,o,t,n,i){r.system={currentTime:moment().locale("pt-br").format("L LTS"),currency:"R$",apiURL:""},r.$on("$locationChangeStart",function(a,o){e.path("/dashboard"),r.system.currentTime=moment().locale("pt-br").format("L LTS"),$(".modal-backdrop").remove(),toastr.clear()}),r.converteGatePrice=function(a,o){try{if(isNaN(a))throw"isNaN";var r=(a/100).toFixed(2).split(".");return r[0]=r[0].split(/(?=(?:...)*$)/).join("."),r.join(",")}catch(a){return""}},r.converteDocumento=function(o){try{var a=goodString(o);return 11==(a=a.replace(/\D/g,"")).length?a=(a=(a=a.replace(/(\d{3})(\d)/,"$1.$2")).replace(/(\d{3})(\d)/,"$1.$2")).replace(/(\d{3})(\d{1,2})$/,"$1-$2"):14==a.length?a=(a=(a=(a=a.replace(/(\d{2})(\d)/,"$1.$2")).replace(/(\d{3})(\d)/,"$1.$2")).replace(/(\d{3})(\d)/,"$1/$2")).replace(/(\d{4})(\d{1,2})$/,"$1-$2"):goodString(o)}catch(a){return o}},r.converteTelefone=function(o){try{var a=goodString(o);return 10==(a=o.replace(/\D/g,"")).length?a=(a=a.replace(/(\d{2})(\d)/,"($1) $2")).replace(/(\d{4})(\d)/,"$1-$2"):11==a.length?a=(a=a.replace(/(\d{2})(\d)/,"($1) $2")).replace(/(\d{5})(\d)/,"$1-$2"):goodString(o)}catch(a){return o}},r.padZero=function(a,o){return Array(Math.max(o-String(a).length+1,0)).join(0)+a},r.moment=function(a){return null==a?"":moment(a).locale("pt-br").format("L LTS")},r.momentDate=function(a){return null==a?"":moment(a).format("DD/MM/YYYY")}}]).factory("focus",["$timeout","$window",function(r,e){return function(a){var o=e.document.getElementById(a);o&&o.focus(),r(function(){o&&o.focus()},500)}}]).directive("eventFocus",["focus",function(e){return function(a,o,r){o.on(r.eventFocus,function(){e(r.eventFocusId)}),a.$on("$destroy",function(){o.off(r.eventFocus)})}}]).filter("sumByKey",function(){return function(a,o){if(void 0===a||void 0===o)return 0;for(var r=0,e=a.length-1;0<=e;e--)r+=parseInt(a[e][o]);return r}});var nodeAuthenticateURL="/api/authenticate";angular.module("admin.dashboard",["ngRoute","chart.js","admin.services.dashboard"]).controller("DashboardViewCtrl",["$log","$rootScope","$scope","dashboardService","$timeout",function(a,o,t,r,e){a.debug("-- DashboardViewCtrl LOADED"),t._isLoadingPagetrTrConciliadas=!1,t._isLoadingPageTrNaoConciliadas=!1,t._isLoadingPageTrEDI=!1,t._isLoadingPageTrAdquirentesTipo=!1;var n="4828321,4828322,4828323,4828324,4828326,4828327,4828328,4828331,4828334,4828335,4828336,4828337,4828339,4828340,4828341,4828342,4828343,4828347";function i(){var r=[],e=[];r.push(""),e.push(""),t.trAdquirentesTipo.forEach(function(a){r.push(a.operacao_Nome);var o=a.valorBruto_Total.replace(".","").replace(",","");e.push(parseInt(o)/100)});var a=google.visualization.arrayToDataTable([r,e]);new google.visualization.BarChart(document.getElementById("chart_div")).draw(a,{title:"Transacao por Tipo",chartArea:{width:"50%"}})}t.trConciliadas=[],t.trNaoConciliadas=[],t.trEDI=[],t.trAdquirentesTipo=[],google.charts.load("current",{packages:["corechart","bar"]}),google.charts.setOnLoadCallback(i),t.load=function(){t._isLoadingPageTrNaoConciliadas=!0,r.getTransactions(2,n).then(function(a){t.trNaoConciliadas=a},function(a){toastr.error("Erro ao carregar as transacoes nao conciliadas"),console.error("Erro ao carregar as transacoes nao conciliadas")}).finally(function(){t._isLoadingPageTrNaoConciliadas=!1,e(function(){t._isLoadingPagetrTrConciliadas=!0,r.getTransactions(1,n).then(function(a){t.trConciliadas=a},function(a){toastr.error("Erro ao carregar as transacoes conciliadas"),console.error("Erro ao carregar as transacoes conciliadas")}).finally(function(){t._isLoadingPagetrTrConciliadas=!1,e(function(){t._isLoadingPageTrEDI=!0,r.getTransactions(1,"48283").then(function(a){t.trEDI=a},function(a){toastr.error("Erro ao carregar as transacoes EDI"),console.error("Erro ao carregar as transacoes EDI")}).finally(function(){t._isLoadingPageTrEDI=!1,e(function(){t._isLoadingPageTrAdquirentesTipo=!0,r.getTrAdquirentesTipo(n).then(function(a){t.trAdquirentesTipo=a},function(a){toastr.error("Erro ao carregar as transacoes adquirentes e tipo"),console.error("Erro ao carregar as transacoes adquirentes e tipo")}).finally(function(){t._isLoadingPageTrAdquirentesTipo=!1,i()})},2e3)})},2e3)})},2e3)})};var c=function(){a.debug("* status polling STARTED"),t.load(),setTimeout(function(){"function"==typeof c&&c()},3e4)};c(),t.$on("$destroy",function(){c=null}),t.enabledGraphic=!0,t.sendEnabledGraphic=function(){t.enabledGraphic=!t.enabledGraphic}}]),angular.module("admin.services.dashboard",[]).service("dashboardService",["$log","$http","$q","$window",function(e,t,n,a){return e.debug("- DashboardService LOADED"),{getTransactions:function(a,o){e.debug("getTransactions type --\x3e "+a);moment().subtract(30,"days").format("YYYY-MM-DD"),moment().format("YYYY-MM-DD");var r=n.defer();return t({method:"GET",url:"http://api.payreport.com.br/api/AutoCom/GetTransacaoConciliacaoPorTecnologia",headers:{Authorization:"Basic dmljdG9yLmR1YXJ0ZUBudGsuY29tLmJyOnZpY3Rvcg=="},params:{pessoaId:"3504",tecnologiaId:o,tecnologiaTipoId:"3,4",dataIni:"2018-03-01",dataFim:"2018-04-06",conciliada:a}}).then(function(a){r.resolve(a.data)},function(a){r.reject(a)}),r.promise},getTrAdquirentesTipo:function(a){e.debug("getTrAdquirentesTipo");moment().subtract(30,"days").format("YYYY-MM-DD"),moment().format("YYYY-MM-DD");var o=n.defer();return t({method:"GET",url:"http://api.payreport.com.br/api/AutoCom/GetTransacaoPorTipo",headers:{Authorization:"Basic dmljdG9yLmR1YXJ0ZUBudGsuY29tLmJyOnZpY3Rvcg=="},params:{pessoaId:"3504",tecnologiaId:a,dataIni:"2018-03-01",dataFim:"2018-04-06"}}).then(function(a){o.resolve(a.data)},function(a){o.reject(a)}),o.promise}}}]);